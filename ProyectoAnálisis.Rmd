--- 
title: "Proyecto Análisis"
output:
  html_document:
    toc: true
    toc_depth: 2
author: "Maddi Casaiz y Ana Díaz"
date: "`r Sys.Date()`"
--- 


```{r include=FALSE}
library(sf)
library(ggplot2)
library(leaflet)
library(osmdata)
library(dplyr)
library(readr)
library(lubridate)
library(car)
```

# Análisis de datos meteorológicos de AEMET

```{r include=FALSE}
datos <- read_csv("aemet_datos_diarios.csv")
datos$fecha <- as.Date(datos$fecha, format="%Y-%m-%d")
datos$año <- year(datos$fecha)
datos$mes <- month(datos$fecha)
datos$mes <- as.numeric(datos$mes)
datos <- datos[!is.na(datos$mes) & datos$mes >= 1 & datos$mes <= 12, ]
datos <- datos %>%
  mutate(
    estacion = case_when(
      mes >= 3 & mes <= 5 ~ 'primavera',
      mes >= 6 & mes <= 8 ~ 'verano',
      mes >= 9 & mes <= 11 ~ 'otoño',
      mes == 12 | mes == 1 | mes == 2 ~ 'invierno',
      TRUE ~ NA_character_
    ),
    estacion = as.factor(estacion)
  )
datos$estacion <- as.factor(datos$estacion)
datos$horatmax[datos$horatmax == "varias"] <- NA
datos$horatmin[datos$horatmin == "varias"] <- NA
datos$tmax <- parse_number(as.character(datos$tmax)) / 10  
datos$tmin <- parse_number(as.character(datos$tmin)) / 10
datos$tmed <- parse_number(as.character(datos$tmed)) / 10
datos$presMax <- parse_number(as.character(datos$presMax))
datos$presMin <- parse_number(as.character(datos$presMin))
datos$prec <- parse_number(as.character(datos$prec))
datos$velmedia <- parse_number(as.character(datos$velmedia))
datos$hrMedia <- parse_number(as.character(datos$hrMedia))

datos$fecha_num <- lubridate::decimal_date(datos$fecha)
datos$horatmax <- ifelse(datos$horatmax %in% c("", "varias", NA), NA, datos$horatmax)
datos$horatmin <- ifelse(datos$horatmin %in% c("", "varias", NA), NA, datos$horatmin)

datos$horatmax_decimal <- NA_real_
valid_max <- !is.na(datos$horatmax)
datos$horatmax_decimal[valid_max] <- {
  horas <- as.numeric(sub(":.*", "", datos$horatmax[valid_max]))
  minutos <- as.numeric(sub(".*:", "", datos$horatmax[valid_max]))
  horas + minutos/60
}

datos$horatmin_decimal <- NA_real_
valid_min <- !is.na(datos$horatmin)
datos$horatmin_decimal[valid_min] <- {
  horas <- as.numeric(sub(":.*", "", datos$horatmin[valid_min]))
  minutos <- as.numeric(sub(".*:", "", datos$horatmin[valid_min]))
  horas + minutos/60
}  # ← ESTA LLAVE FALTABA

datos2 <- read_csv("aemet_datos_diarios_pamplona.csv")
datos2$fecha <- as.Date(datos2$fecha, format="%Y-%m-%d")
datos2$año <- year(datos2$fecha)
datos2$mes <- month(datos2$fecha)
datos2$mes <- as.numeric(datos2$mes)
datos2 <- datos2[!is.na(datos2$mes) & datos2$mes >= 1 & datos2$mes <= 12, ]
datos2 <- datos2 %>%
  mutate(
    estacion = case_when(
      mes >= 3 & mes <= 5 ~ 'primavera',
      mes >= 6 & mes <= 8 ~ 'verano',
      mes >= 9 & mes <= 11 ~ 'otoño',
      mes == 12 | mes == 1 | mes == 2 ~ 'invierno',
      TRUE ~ NA_character_
    ),
    estacion = as.factor(estacion)
  )
datos2$estacion <- as.factor(datos2$estacion)
datos2$horatmax[datos2$horatmax == "varias"] <- NA
datos2$horatmin[datos2$horatmin == "varias"] <- NA
datos2$tmax <- parse_number(as.character(datos2$tmax)) / 10  
datos2$tmin <- parse_number(as.character(datos2$tmin)) / 10
datos2$tmed <- parse_number(as.character(datos2$tmed)) / 10
datos2$presMax <- parse_number(as.character(datos2$presMax))
datos2$presMin <- parse_number(as.character(datos2$presMin))
datos2$prec <- parse_number(as.character(datos2$prec))
datos2$velmedia <- parse_number(as.character(datos2$velmedia))
datos2$hrMedia <- parse_number(as.character(datos2$hrMedia))

datos2$fecha_num <- lubridate::decimal_date(datos2$fecha)
datos2$horatmax <- ifelse(datos2$horatmax %in% c("", "varias", NA), NA, datos2$horatmax)
datos2$horatmin <- ifelse(datos2$horatmin %in% c("", "varias", NA), NA, datos2$horatmin)

datos2$horatmax_decimal <- NA_real_
valid_max <- !is.na(datos2$horatmax)
datos2$horatmax_decimal[valid_max] <- {
  horas <- as.numeric(sub(":.*", "", datos2$horatmax[valid_max]))
  minutos <- as.numeric(sub(".*:", "", datos2$horatmax[valid_max]))
  horas + minutos/60
}

datos2$horatmin_decimal <- NA_real_
valid_min <- !is.na(datos2$horatmin)
datos2$horatmin_decimal[valid_min] <- {
  horas <- as.numeric(sub(":.*", "", datos2$horatmin[valid_min]))
  minutos <- as.numeric(sub(".*:", "", datos2$horatmin[valid_min]))
  horas + minutos/60
}

datos2 <- datos2[
  !is.na(datos2$tmin) & 
  !is.na(datos2$tmed) & 
  !is.na(datos2$tmax) & 
  !is.na(datos2$horatmax_decimal) & 
  !is.na(datos2$horatmin_decimal) &
  !is.na(datos2$fecha_num), ]

```
# Evolución de las temperaturas a lo largo de los años

## Regresión lineal de las temperaturas medias desde 2000

Para ver la evolución de las temperaturas a lo largo de los años, ajustamos una regresión lineal simple para la temperatura media diaria (tmed) en función del año (fecha_num).
Representamos en un gráfico de dispersión las temperaturas medias diarias y añadimos la recta de regresión ajustada.

```{r}
modelo <- lm(tmed ~ fecha_num, data = datos)
coef = coefficients(modelo)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(tmed ~ fecha_num, data = datos,
        ylab="Temperatura máxima (°C)",
        xlab="Año",
        main="Temperaturas diarias")
lines(x, recta1, col = "green")
coef
```
Como podemos observar, la pendiente de la recta de regresión es positiva, lo que indica un aumento en la temperatura media diaria a lo largo de los años, sugiriendo una tendencia de calentamiento.
## Representación de las temperaturas máximas y mínimas anuales
Veamos ahora si esto ocurre también en las temperaturas máximas y mínimas. Para que los datos se vean más claramente en vez de representar los datos diarios de los tres datos, vamos a calcular las medias anuales de tmed, tmax y tmin y representarlas en un mismo gráfico con sus respectivas rectas de regresión.
```{r}
medias_anuales <- aggregate(tmed ~ año, data = datos, mean)

medias_tmax <- aggregate(tmax ~ año, data = datos, mean)
medias_tmin <- aggregate(tmin ~ año, data = datos, mean)

medias_anuales <- merge(medias_anuales, medias_tmax, by = "año")
medias_anuales <- merge(medias_anuales, medias_tmin, by = "año")
modelo_tmed <- lm(tmed ~ año, data = medias_anuales)
modelo_tmax <- lm(tmax ~ año, data = medias_anuales)
modelo_tmin <- lm(tmin ~ año, data = medias_anuales)

# Coeficientes
coef_tmed <- coefficients(modelo_tmed)
coef_tmax <- coefficients(modelo_tmax)
coef_tmin <- coefficients(modelo_tmin)
coef_tmed
coef_tmax
coef_tmin

x <- seq(2000, 2025, 1)
recta_tmed <- coef_tmed[1] + x * coef_tmed[2]
recta_tmax <- coef_tmax[1] + x * coef_tmax[2]
recta_tmin <- coef_tmin[1] + x * coef_tmin[2]

# Graficar - vamos a hacer un gráfico con los puntos de tmed, tmax y tmin

plot(tmed ~ año, data = medias_anuales, 
     ylab = "Temperatura (°C)", 
     xlab = "Año",
     main = "Temperaturas medias, máximas y mínimas anuales",
     ylim = range(medias_anuales[, c("tmed", "tmax", "tmin")]), 
     pch = 16, col = "black")
points(tmax ~ año, data = medias_anuales, pch = 16, col = "red")
points(tmin ~ año, data = medias_anuales, pch = 16, col = "blue")

# Añadir las rectas de tendencia
lines(x, recta_tmed, col = "black")
lines(x, recta_tmax, col = "red")
lines(x, recta_tmin, col = "blue")

# Leyenda
legend("topleft", 
       legend = c("Media", "Máxima", "Mínima"), 
       col = c("black", "red", "blue"), 
       pch = 16, 
       lty = 1)
```

De este gráfico y de los valores de los coeficientes de las pendientes, podemos observar que tanto las temperaturas máximas como las mínimas han aumentado a lo largo de los años, con la temperatura máxima mostrando un aumento más pronunciado en comparación con la mínima. Esto sugiere que el calentamiento global está afectando de manera más significativa a las temperaturas máximas diarias. 


# Relacion entre las medias de temperatura alta y baja
Ya hemos visto que tanto las temperaturas máximas como las mínimas han aumentado a lo largo de los años. Ahora queremos ver si existe una relación significativa entre las temperaturas máximas y mínimas diarias. Esto lo lograremos mediante un boxplot comparativo y un test t-pareado.
Como se tratan de datos pareados (las temperaturas máxima y mínima del mismo día), utilizaremos un test t-pareado para evaluar si hay una diferencia significativa entre las medias de las dos variables. La hipótesis nula (H0) es que no hay diferencia en las medias de tmax y tmin, mientras que la hipótesis alternativa (H1) es que sí hay una diferencia significativa.
```{r}
# Comparar visualmente tmax y tmin
boxplot(datos$tmax, datos$tmin, 
        names = c("Temp. Máxima", "Temp. Mínima"),
        ylab = "Temperatura (°C)",
        main = "Comparación de temperaturas máximas y mínimas")

# Test t-pareado para verificar si hay diferencias significativas
t.test(datos$tmax, datos$tmin, paired = TRUE)
```
El p-value del t-test nos indica si rechazamos o no la hipótesis nula. El p-valor es mucho menor que 0.05 (2.2e-16) por lo que rechazamos H0 y concluimos que hay una diferencia significativa entre las temperaturas máximas y mínimas diarias. Es decir, las temperaturas máximas y mínimas no aumentan de manera uniforme, lo que podría tener implicaciones importantes para la comprensión del impacto del cambio climático en los patrones de temperatura diaria.

# ¿El calentamiento afecta a todas las estaciones por igual?
Primero representemos las temperaturas medias diarias por estaciones del año mediante un boxplot con los datos desde el año 2000.
```{r}
boxplot(tmed ~ estacion, data = datos)
```

## Variabilidad por estaciones de hora de temperatura máxima y mínima

Ahora vamos a ver si la hora a la que se alcanza la temperatura máxima ha cambiado a lo largo de los años en las distintas estaciones del año. Para ello ajustamos una regresión lineal para cada estación del año y representamos las rectas de regresión sobre el gráfico de dispersión de las horas de temperatura máxima frente al año.

### En verano
```{r}
datos_verano <- datos[datos$estacion == 'verano' & datos$horatmax_decimal, ]
modelo  <- lm(horatmax_decimal ~ fecha_num, data = datos_verano)
coef = coefficients(modelo)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(horatmax_decimal ~ fecha_num, data = datos,
        ylab="Temperatura máxima (°C)",
        xlab="Año",
        main="Temperaturas diarias")
lines(x, recta1, col = "red" )
coef
```

### En otoño

```{r}
modelo  <- lm(horatmax_decimal ~ fecha_num, data = datos[datos$estacion == 'otoño', ])
coef = coefficients(modelo)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(horatmax_decimal ~ fecha_num, data = datos,
        ylab="Temperatura máxima (°C)",
        xlab="Año",
        main="Temperaturas diarias")
lines(x, recta1, col = "red" )
coef
```

### En invierno
```{r}
modelo  <- lm(horatmax_decimal ~ fecha_num, data = datos[datos$estacion == 'invierno', ])
coef = coefficients(modelo)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(horatmax_decimal ~ fecha_num, data = datos,
        ylab="Temperatura máxima (°C)",
        xlab="Año",
        main="Temperaturas diarias")
lines(x, recta1, col = "red" )
coef
```

### En primavera
```{r}
modelo  <- lm(horatmax_decimal ~ fecha_num, data = datos[datos$estacion == 'primavera', ])
coef = coefficients(modelo)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(horatmax_decimal ~ fecha_num, data = datos,
        ylab="Temperatura máxima (°C)",
        xlab="Año",
        main="Temperaturas diarias")
lines(x, recta1, col = "red" )
coef
```

(Comparamos las coef[2] de cada una de ellas (la pendiente))
### ¿Ha cambiado la hora de la temperatura máxima a lo largo de los años?
Veamos ahora si la diferencia de medias de horas máximas entre el primer y último año son estadísticamente significativas
```{r}
datos_ultimo = datos[datos$año == 2024, ]
datos_primero = datos[datos$año == 2000, ]
t.test(datos_primero$horatmax_decimal, datos_ultimo$horatmax_decimal, paired = FALSE)
```
El p-valor obtenido es 0.05352, que es ligeramente mayor que el umbral común de 0.05. Por lo tanto, no rechazamos la hipótesis nula y concluimos que no hay evidencia suficiente para afirmar que la hora de la temperatura máxima ha cambiado significativamente entre el año 2000 y 2024.

# Regresión lineal múltiple para predecir la temperatura máxima diaria
```{r}
pairs(~tmax+tmin+tmed+año+mes+horatmax_decimal+datos$horatmin_decimal+prec+velmedia+presMin+presMax+hrMedia, data=datos, pch = 16, cex = 0.5)
modelo_mult <- lm(tmax ~ tmin + tmed + año + mes + horatmax_decimal + datos$horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos)
summary(modelo_mult)
vif(modelo_mult)
```

```{r}
pairs(~tmax+tmin+tmed+año+mes+horatmax_decimal+horatmin_decimal+prec+velmedia+presMin+presMax+hrMedia, data=datos, pch = 16, cex = 0.5)
modelo_mult <- lm(tmax ~ tmin + tmed + año + mes + horatmax_decimal + horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos)
summary(modelo_mult)
vif(modelo_mult)
```

```{r}
predictors <- c("tmax","tmin","tmed","año","mes","horatmax_decimal","horatmin_decimal","prec","velmedia","presMin","presMax","hrMedia")
datos_complete <- datos[, predictors]
datos_complete <- datos_complete[complete.cases(datos_complete), ]
fit1 <- lm(tmax ~ tmin + tmed + año + horatmax_decimal + horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos_complete)
fit2 <- lm(tmax ~ 1, data = datos_complete)
modelAIC <- step(fit2, scope = list(lower=fit2, upper=fit1), direction="forward")
formula <- formula(modelAIC)
modelFinal <- lm(formula, data = datos_complete)
summary(modelFinal)
library(car)
vif(modelFinal)
```
Como podemos ver por el VIF las variables están poco correlacionadas entre sí. Es decir Step AIC ha funcionado correctamente para eliminar las variables que estaban correlacionadas.

# Comparación con Pamplona
## Evolución de las temperaturas a lo largo de los años en Pamplona

Realizamos todos los analisis que los apartados 1,2 y 5 para la base de datos de aemet_datos_diarios_pamplona

```{r}

modelo2 <- lm(tmed ~ fecha_num, data = datos2)
coef = coefficients(modelo2)
recta1 = coef[1] + seq(2000,2025,1)* coef[2]
x <- seq(2000,2025,1)
plot(tmed ~ fecha_num, data = datos2,
     ylab="Temperatura máxima (°C)",
     xlab="Año",
     main="Temperaturas diarias")

lines(x, recta1, col = "green")

medias_anuales2 <- aggregate(tmed ~ año, data = datos2, mean)
#Evolucion de las temperaturas a lo largo de los años 
# Calcular medias anuales para tmax y tmin
medias_tmax <- aggregate(tmax ~ año, data = datos2, mean)
medias_tmin <- aggregate(tmin ~ año, data = datos2, mean)

# Unir a medias_anuales2
medias_anuales2 <- merge(medias_anuales2, medias_tmax, by = "año")
medias_anuales2 <- merge(medias_anuales2, medias_tmin, by = "año")

# Ahora medias_anuales2 tiene las columnas: año, tmed, tmax, tmin
# Ajustar modelos para tmax y tmin
modelo_tmed <- lm(tmed ~ año, data = medias_anuales2)
modelo_tmax <- lm(tmax ~ año, data = medias_anuales2)
modelo_tmin <- lm(tmin ~ año, data = medias_anuales2)

# Coeficientes
coef_tmed <- coefficients(modelo_tmed)
coef_tmax <- coefficients(modelo_tmax)
coef_tmin <- coefficients(modelo_tmin)

# Generar secuencia de años para las rectas
x <- seq(2000, 2025, 1)
recta_tmed <- coef_tmed[1] + x * coef_tmed[2]
recta_tmax <- coef_tmax[1] + x * coef_tmax[2]
recta_tmin <- coef_tmin[1] + x * coef_tmin[2]

# Graficar - vamos a hacer un gráfico con los puntos de tmed, tmax y tmin
plot(tmed ~ año, data = medias_anuales2, 
     ylab = "Temperatura (°C)", 
     xlab = "Año",
     main = "Temperaturas medias, máximas y mínimas anuales",
     ylim = range(medias_anuales2[, c("tmed", "tmax", "tmin")]), 
     pch = 16, col = "black")
points(tmax ~ año, data = medias_anuales2, pch = 16, col = "red")
points(tmin ~ año, data = medias_anuales2, pch = 16, col = "blue")

# Añadir las rectas de tendencia
lines(x, recta_tmed, col = "black")
lines(x, recta_tmax, col = "red")
lines(x, recta_tmin, col = "blue")

# Leyenda
legend("topleft", 
       legend = c("Media", "Máxima", "Mínima"), 
       col = c("black", "red", "blue"), 
       pch = 16, 
       lty = 1)
```

# Relacion entre las medias de temperatura alta y baja en Pamplona

```{r}
boxplot(datos2$tmax, datos2$tmin, 
        names = c("Temp. Máxima", "Temp. Mínima"),
        ylab = "Temperatura (°C)",
        main = "Comparación de temperaturas máximas y mínimas en Pamplona")
t.test(datos2$tmax, datos2$tmin, paired = TRUE)
```
Hacer comparacion de los valores de las betas de las regresiones lineales de uno y otro

# Regresión lineal múltiple para predecir la temperatura máxima diaria en Pamplona
```{r}
pairs(~tmax+tmin+tmed+año+mes+horatmax_decimal+horatmin_decimal+prec+velmedia+presMin+presMax+hrMedia, data=datos2, pch = 16, cex = 0.5)
modelo_mult <- lm(tmax ~ tmin + tmed + año + mes + horatmax_decimal + horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos2)
summary(modelo_mult)
vif(modelo_mult)
```


```{r}


predictors <- c("tmax","tmin","tmed","año","mes","horatmax_decimal","horatmin_decimal","prec","velmedia","presMin","presMax","hrMedia")
datos_complete <- datos2[, predictors]
datos_complete <- datos_complete[complete.cases(datos_complete), ]
fit1 <- lm(tmax ~ tmin + tmed + año + horatmax_decimal + horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos_complete)
fit2 <- lm(tmax ~ 1, data = datos_complete)
modelAIC <- step(fit2, scope = list(lower=fit2, upper=fit1), direction="forward")
formula <- formula(modelAIC)
modelFinal <- lm(formula, data = datos_complete)
summary(modelFinal)
library(car)
vif(modelFinal)
```

# Prediccion de las temperaturas máximas en los próximos 10 años
Queremos ahora comparar las temperaturas que se esperan en los próximos 10 años en ambas ciudades. Para eso vamos a usar el modelo ajustado en el apartado 5 e incluimos el año como variable predictora. Además vamos a usar las medianas de las demás variables predictoras para hacer las predicciones y que estás tengan un sentido más realista que usar valores aleatorios.
```{r}
anios_pred <- seq(2026, 2035)
med_tmin <- median(datos$tmin, na.rm = TRUE)
med_mes <- median(datos$mes, na.rm = TRUE)
med_horatmax <- median(datos$horatmax_decimal, na.rm = TRUE)
med_horatmin <- median(datos$horatmin_decimal, na.rm = TRUE)
med_prec <- median(datos$prec, na.rm = TRUE)
med_velmedia <- median(datos$velmedia, na.rm = TRUE)
med_presMin <- median(datos$presMin, na.rm = TRUE)
med_presMax <- median(datos$presMax, na.rm = TRUE)
med_hrMedia <- median(datos$hrMedia, na.rm = TRUE)

nuevos_datos <- data.frame(
  año = anios_pred,
  tmin = rep(med_tmin, length(anios_pred)),
  mes = rep(med_mes, length(anios_pred)),
  horatmax_decimal = rep(med_horatmax, length(anios_pred)),
  horatmin_decimal = rep(med_horatmin, length(anios_pred)),
  prec = rep(med_prec, length(anios_pred)),
  velmedia = rep(med_velmedia, length(anios_pred)),
  presMin = rep(med_presMin, length(anios_pred)),
  presMax = rep(med_presMax, length(anios_pred)),
  hrMedia = rep(med_hrMedia, length(anios_pred))
)

# Modelo ajustado incluyendo año
modelo_final <- lm(tmax ~ tmin + año + mes + horatmax_decimal + horatmin_decimal+ prec + velmedia + presMin + presMax + hrMedia, data = datos)
predicciones <- predict(modelo_final, newdata = nuevos_datos, interval = "prediction")
predicciones

#ahora repetimos el proceso para pamplona
anios_pred <- seq(2026, 2035)
med_tmin2 <- median(datos2$tmin, na.rm = TRUE)
med_mes2 <- median(datos2$mes, na.rm = TRUE)
med_horatmax2 <- median(datos2$horatmax_decimal, na.rm = TRUE)
med_horatmin2 <- median(datos2$horatmin_decimal, na.rm = TRUE)
med_prec2 <- median(datos2$prec, na.rm = TRUE)
med_velmedia2 <- median(datos2$velmedia, na.rm = TRUE)
med_presMin2 <- median(datos2$presMin, na.rm = TRUE)
med_presMax2 <- median(datos2$presMax, na.rm = TRUE)
med_hrMedia2 <- median(datos2$hrMedia, na.rm = TRUE)

nuevos_datos2 <- data.frame(
  año = anios_pred,
  tmin = rep(med_tmin2, length(anios_pred)),
  mes = rep(med_mes2, length(anios_pred)),
  horatmax_decimal = rep(med_horatmax2, length(anios_pred)),
  horatmin_decimal = rep(med_horatmin2, length(anios_pred)),
  prec = rep(med_prec2, length(anios_pred)),
  velmedia = rep(med_velmedia2, length(anios_pred)),
  presMin = rep(med_presMin2, length(anios_pred)),
  presMax = rep(med_presMax2, length(anios_pred)),
  hrMedia = rep(med_hrMedia2, length(anios_pred))
)
modelo_final2<- lm(tmax ~ tmin + año + mes + horatmax_decimal + horatmin_decimal + prec + velmedia + presMin + presMax + hrMedia, data = datos2)
predicciones2 <- predict(modelo_final2, newdata = nuevos_datos2, interval = "prediction")
predicciones2
```

Como podemos observar en las predicciones realizadas para ambas ciudades, se espera un aumento gradual de las temperaturas máximas diarias en los próximos 10 años. Este incremento es consistente con las tendencias observadas en los datos históricos y refleja el impacto continuo del cambio climático en nuestras regiones. En San Sebastián, las temperaturas máximas proyectadas muestran un aumento más pronunciado en comparación con Pamplona, lo que podría atribuirse a factores geográficos y climáticos específicos de cada área. 
Para hacer un énfasis del aumento de las temperaturas desde el año 2000 haremos una predicción de la temperatura de ese año usando las medianas de las demás variables predictoras y compararemos el resultado con las predicciones para los próximos 10 años. En San Sebastián:

```{r}
nuevo_inicial <- data.frame(
  año = min(datos$año, na.rm = TRUE),
  tmin = med_tmin,
  mes = med_mes,
  horatmax_decimal = med_horatmax,
  horatmin_decimal = med_horatmin,
  prec = med_prec,
  velmedia = med_velmedia,
  presMin = med_presMin,
  presMax = med_presMax,
  hrMedia = med_hrMedia
)
pred_inicio <- predict(modelo_final, newdata = nuevo_inicial, interval = "prediction")
pred_inicio
```
(rellenar los datos con los que pone abajo)
El modelo predice que la temperatura máxima podría aumentar %.2f grados para 2035 respecto al año inicial, con un intervalo de confianza entre %.2f y %.2f grados.\n
pred2035[1] - pred_inicio[1], pred2035[2] - pred_inicio[2], pred2035[3] - pred_inicio[3]

Repitamos el proceso para Pamplona: 
```{r} 
nuevo_inicial2 <- data.frame(
  año = min(datos2$año, na.rm = TRUE),
  tmin = med_tmin2,
  mes = med_mes2,
  horatmax_decimal = med_horatmax2,
  horatmin_decimal = med_horatmin2,
  prec = med_prec2,
  velmedia = med_velmedia2,
  presMin = med_presMin2,
  presMax = med_presMax2,
  hrMedia = med_hrMedia2
)
pred_inicio2 <- predict(modelo_final2, newdata = nuevo_inicial2, interval = "prediction")
pred_inicio2
```
El modelo predice que la temperatura máxima podría aumentar %.2f grados para 2035 respecto al año inicial, con un intervalo de confianza entre %.2f y %.2f grados.\n
pred2035_2[1] - pred_inicio2[1], pred2035_2[2] - pred_inicio2[2], pred2035_2[3] - pred_inicio2[3]


cd /workspaces/ProyectoAnalisis 
R --vanilla --slave -e "rmarkdown::render('ProyectoAnálisis.Rmd')"